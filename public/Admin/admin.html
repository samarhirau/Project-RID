<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin page</title>
    <link rel="stylesheet" href="../css/admin.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>


    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <style>
    /* Toast container style */
    .toastify-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
    }

    /* Individual toast notification style */
    .toastify-toast {
      background: #333; /* Dark background */
      color: #fff; /* White text color */
      border-radius: 8px; /* More rounded corners */
      padding: 15px 20px; /* More padding */
      margin: 10px 0; /* Spacing between toasts */
      font-size: 15px; /* Slightly larger font size */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow */
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden; /* Ensure the timer line stays within bounds */
    }

    /* Timer line style */
    .toastify-toast .timer-line {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: rgba(
        255,
        255,
        255,
        0.6
      ); /* Light color for timer line */
      width: 100%;
      transform: translateX(-100%); /* Start with timer line off-screen */
      transition: transform 3s linear; /* Timer line animation */
    }

    /* Close button style */
    .toastify-toast .toastify-close {
      cursor: pointer;
      color: #ff5722; /* Close button color */
      font-size: 18px;
    }

    /* Toast types */
    .toastify-success {
      background: #4caf50; /* Green background for success */
    }

    .toastify-error {
      background: #f44336; /* Red background for error */
    }

    .toastify-info {
      background: orange; /* Blue background for info */
    }
  </style>

  <style>
    .student-list {
      padding: 20px;
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    .student-list h3 {
      margin: 0 0 20px 0;
    }

    table {
      width: 100%;
      /* border-collapse: collapse; */
      overflow-x: auto; /* Enable horizontal scrolling */
      white-space: nowrap; /* Prevent wrapping */
      border-collapse: collapse; /* Clean table appearance */
    }

    table th,
    table td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
      min-width: auto;
    }

    table th {
      background-color: #003366;
      color: white;
    }

    table a {
      color: #003366;
      text-decoration: none;
    }

    table a:hover {
      text-decoration: underline;
    }
    .active {
      background: #0a66c2 !important;

      color: #fff !important;
    }
  </style>
  </head>
  <body>
    <div id="admin-content">
      <header>
       <div class="header">
        <div class="web-text">
          <p>
            Website:
            <span
              >RID (Research Innovation & Discovery) by TWKSAA Welfare
              Foundation
            </span>
          </p>

          <p>Helpline: <span>+91-98927 82728 </span></p>
          <p>Email: <span>supportid@gamil.com</span></p>
        </div>
        <div class="right-text">
          <a class="link" href="#"
            ><object
              class="svg-object"
              data="/assets/icons/important_devices.svg"
              type="image/svg+xml"
            ></object
            >Main Content</a
          >
          <a class="link" href="#">+A A A-</a>
          <a class="link" href="#"
            ><object
              class="svg-object"
              data="/assets/icons/forum.svg"
              type="image/svg+xml"
            ></object
            >Feedback</a
          >
          <a class="link" href="#"
            ><object
              class="svg-object"
              data="./assets/icons/support_agent.svg"
              type="image/svg+xml"
            ></object
            >Support</a
          >
        </div>
      </div>
        <div class="lower-header">
          <div class="left-content">
            <div class="logo">
              <img src="../assets/RID Concept Long.svg" alt="RID logo" width="250" />
            </div>
          </div>
          <div class="right-content">
        
            <button
            id="certificate"
            onclick="window.location.href= '/verify'"
          >
            <span class="material-symbols-outlined">
              developer_guide
            </span>
            Certificate
          </button>
           
            
          </div>
        </div>

       
      </header>
      <span class="menu-icon" onclick="toggleSidebar()"
        ><span class="material-symbols-outlined"> menu </span></span
      >

      <div class="main-content">
        <div class="side-bar" id="sidebar">
          <div class="div1">
            <div
              class="close-btn"
              style="display: none"
              onclick="toggleSidebar()"
            >
              <span class="material-symbols-outlined"> close </span>
            </div>
            <div>
              <h2>Administrator</h2>
              <button id="dashboardbtn">
                <span class="material-symbols-outlined" style="font-size: 20px">
                  bar_chart_4_bars </span
                ><span>Dashboard</span>
              </button>
              <button
                style="color: black; background-color: white"
                onclick="showTotalList()"
                id="showTotal"
              >
                <span class="material-symbols-outlined" style="font-size: 20px">
                  group </span
                ><span>Total Registration</span>
              </button>
            </div>
            <div>
              <h2>Certificate tool</h2>
              <button
                id="uploadCerti"
                onclick="uploadcertificate()"
                style="color: black; background-color: white"
              >
                <span class="material-symbols-outlined" style="font-size: 20px">
                  workspace_premium </span
                ><span>Upload Certificate</span>
              </button>
            </div>
            <div>
              <h2>Admin Features</h2>
              <button
                style="color: black; background-color: white"
                onclick="showChangeRole()"
              >
                <span class="material-symbols-outlined" style="font-size: 20px">
                  workspace_premium
                </span>
                <span>Change Role</span>
              </button>

              <button
                style="color: black; background-color: white"
                onclick="showAdminList()"
              >
                <span class="material-symbols-outlined" style="font-size: 20px">
                  workspace_premium
                </span>
                <span onclick="showAllAdmins()">View Admin Accounts</span>
              </button>
            </div>
          </div>
          <footer>
            <h2>Admin Account</h2>
            <button id="logout-btn">
              <span class="material-symbols-outlined" style="font-size: 20px">
                logout
              </span>
              <span>Logout</span>
            </button>
          </footer>
        </div>
      

        <div class="main-area" id="mainArea">
          <h2>Dashboard (Overall Summary)</h2>
          <!-- Overall Summary -->
          <div class="summary-box green-box">
            <span class="material-symbols-outlined"> group </span>
            <h3>Total Registration</h3>
            <p id="registrations-count">Loading..</p>
          </div>
        
          <div class="summary-box red-box">
            <span class="material-symbols-outlined"> picture_as_pdf </span>
            <h3>Total PDF(s)</h3>
            <p>43</p>
          </div>
        
          <div class="summary-box orange-box">
            <span class="material-symbols-outlined"> book </span>
            <h3>Total E Book(s)</h3>
            <p>32</p>
          </div>
        
          <div class="summary-box pink-box">
            <span class="material-symbols-outlined"> assignment </span>
            <h3>Total RP(s)</h3>
            <p>234</p>
          </div>
        
          <h2>Role Based Summary</h2>
          <!-- Role-Based Summary -->
          <div class="role-box light-blue-box">
            <span class="material-symbols-outlined"> admin_panel_settings </span>
            <h3>Total Admin Assigned</h3>
            <p id="adminCount">Loading...</p>
          </div>
        
          <div class="role-box light-blue-box">
            <span class="material-symbols-outlined"> person </span>
            <h3>Registered Teachers</h3>
            <p id="teacherCount">Loading...</p>
          </div>
        
          <div class="role-box light-blue-box">
            <span class="material-symbols-outlined"> school </span>
            <h3>Registered Students</h3>
            <p id="studentCount">Loading...</p>
          </div>
        
          <div class="role-box light-blue-box">
            <span class="material-symbols-outlined"> business </span>
            <h3>Registered Organizations</h3>
            <p id="organisationCount">Loading...</p>
          </div>
        </div>
        


        <section class="student-list" id="table-list" style="display: none">
          <h3>List of Total Students</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>S.No.</th>
                  <th>Name</th>
                  <th>Email Address</th>
                  <th>Role</th>
                  <th>Gender</th>
                  <th>Date Of Birth</th>
                  <th>A/C Creation Date</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="user-list">
                <!-- Rows will be populated here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- change role -->
        <section id="changeRole" style="display: none">
          <!-- Search for User by Email -->
          <h1>Change Role</h1>
          <input type="text" id="emailSearch" placeholder="Enter user email" />
          <button onclick="searchUser()">Search User</button>

          <!-- Display User Info -->
          <div id="userInfo" style="display: none">
            <p id="userEmail"></p>
            <label for="userRole">Change Role:</label>
            <select id="userRole">
              <option value="student">Student</option>
              <option value="teacher">Teacher</option>
              <option value="organisation">Organisation</option>
              <option value="admin">Admin</option>
            </select>
            <button onclick="changeUserRole()">Change Role</button>
          </div>
        </section>


        <section id="allAdmins">
          <section class="student-list" id="adminList" style="display: none;">
            <h3>List of Total Admin</h3>
            <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>S.No.</h>
                  <th>Name</th>
                  <th>Email Address</th>
                  <th>Role</th>~
                  <th>Gender</th>
                  <th>A/C Creation Date</th>
                </tr>
              </thead>

              <tbody id="admins">
                <!-- Rows will be populated here -->
              </tbody>
            </table>
          </div>
          </section>
        </section>

        <div class="main-area1" id="mainArea1" style="display: none">
          <!-- ------------- -->
          <h2>Upload Certificate</h2>

          <form id="uploadForm" class="uploadForm">
            <section>
              <div class="form-group">
                <label
                  >Certificate Id
                  <span style="color: red; font-weight: bold">*</span></label
                >
                <input
                  type="text"
                  name="certificateId"
                  id="certificateId"
                  placeholder="eg: RIDXR24354"
                  required
                />
              </div>
              <div class="form-group">
                <label
                  >Issue Date
                  <span style="color: red; font-weight: bold">*</span></label
                >
                <input
                  type="date"
                  name="issueDate"
                  id="issueDate"
                  placeholder="DD/MM/YYYY"
                  required
                />
              </div>
              <div class="form-group">
                <label
                  >Intern or Student Name
                  <span style="color: red; font-weight: bold">*</span></label
                >
                <input
                  type="text"
                  name="internName"
                  id="internName"
                  placeholder="John Doe"
                  required
                />
              </div>
              <div class="form-group">
                <label
                  >Description
                  <span style="color: grey; font-weight: 400"
                    >(Optional)</span
                  ></label
                >
                <input
                  type="text"
                  name="description"
                  id="description"
                  placeholder="Write Description or leave it blank"
                />
              </div>

              <div class="form-group">
                <label
                  >Upload Certificate
                  <span style="color: red; font-weight: bold">*</span></label
                >
                <input
                  type="file"
                  name="certificateFile"
                  id="certificateFile"
                  required
                  hidden
                />
                <div id="dropArea" class="drop-area">
                  <p>Drag & Drop your file here or click to upload</p>
                </div>
              </div>
            </section>
            <button type="submit">Upload Now</button>
          </form>
        </div>
      </div>
    </div>
    <script>
   
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const mainArea = document.getElementById("mainArea");

        if (sidebar.style.display === "none" || sidebar.style.display === "") {
          // Reset the display property to show the sidebar again
          sidebar.style.display = "block";
        }

        // Toggle the 'active' class for sliding animation
        sidebar.classList.toggle("active");

        // Toggle hiding of main content when the sidebar is active
        if (sidebar.classList.contains("active")) {
          mainArea.classList.add("hide"); // Hide main area when sidebar is active
        } else {
          mainArea.classList.remove("hide"); // Show main area when sidebar is hidden
        }
      }
    </script>

    <script>
        async function fetchRegistrationsCount() {
    try {
      const response = await fetch('/admin/registrations/count');
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const data = await response.json();
      document.getElementById('registrations-count').textContent = ` ${data.count}`;
    } catch (error) {
      document.getElementById('registrations-count').textContent = 'Failed to load number of registrations';
      showToast('Error fetching registrations count', '#f44336');
      console.error('Error fetching registrations count:', error);
    }
  }

  fetchRegistrationsCount();
    </script>

    <script>
      async function fetchEbooksCount() {
  try {
    const response = await fetch('/admin/ebooks/count');
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    const data = await response.json();
    document.getElementById('ebooks-count').textContent = ` ${data.count}`;
  } catch (error) {
    document.getElementById('ebooks-count').textContent = 'Failed to load eBooks count';
    showToast('Error fetching eBooks count', '#f44336');
    console.error('Error fetching eBooks count:', error);
  }
}

fetchEbooksCount();

    </script>

    <script src="../js/showToast.js"></script>
    <script src="../js/admin.js"></script>
    <script>
      // Fetch users from the server (Make sure the server provides this endpoint)
      // Function to search for a user by email
      function searchUser() {
        const email = document.getElementById("emailSearch").value;

        fetch(`/admin/search-user?email=${email}`, {
          method: "GET",
          credentials: "include", // Include cookies for authentication
        })
          .then((response) => response.json())
          .then((user) => {
            if (user.message) {
              alert(user.message);
            } else {
              document.getElementById("userInfo").style.display = "block";
              document.getElementById(
                "userEmail"
              ).textContent = `Email: ${user.email}`;
              document.getElementById("userRole").value = user.role;
            }
          })
          .catch((error) => console.error("Error fetching user:", error));
      }

      // Function to change the user role
      function changeUserRole() {
        const email = document
          .getElementById("userEmail")
          .textContent.split("Email: ")[1];
        const newRole = document.getElementById("userRole").value;

        fetch("/admin/change-role", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ email, role: newRole }),
          credentials: "include",
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message); // Notify admin of success or failure
          })
          .catch((error) => console.error("Error changing user role:", error));
      }
    </script>

    <script>
      // Function to show all admins
      function showAllAdmins() {
        fetch("/admin/all-admins", {
          method: "GET",
          credentials: "include",
        })
          .then((response) => response.json())
          .then((admins) => {
            if (admins.message) {
              alert(admins.message);
            } else {
              document.getElementById("adminList").style.display = "block";
              const adminList = document.getElementById("admins");
              adminList.innerHTML = ""; // Clear the list before adding new data
              admins.forEach((admin, index) => {
                const row = document.createElement("tr"); // Create a new table row for each admin
                row.innerHTML = `
            <td>${index + 1}</td>
            <td>${admin.name} ${admin.lastname}</td>
            <td>${admin.email}</td>
            <td>${admin.role}</td>
            <td>${admin.gender}</td>
            <td>${admin.createdAt.substr(0,10)}</td>
          `;
                adminList.appendChild(row);
              });
            }
          })
          .catch((error) => console.error("Error fetching admins:", error));
      }
    </script>

    <script>
      // Fetch users and populate the tab   ----
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/admin/users", { method: "GET", credentials: "include" })
          .then((response) => response.json())
          .then((users) => {
            const userList = document.getElementById("user-list");
            userList.innerHTML = ""; // Clear existing content
            users.forEach((user, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
              <td>${index + 1}</td>
              <td>${user.name} ${user.lastname}</td>
              <td>${user.email}</td>
              <td>${user.role}</td>
              <td>${user.gender}</td>
              <td>${user.dob.split("T")[0]}</td>
              <td>${new Date().toLocaleDateString()}</td>
              <td><a href="#">View</a></td>
            `;
              userList.appendChild(row);
            });
          })
          .catch((error) => console.error("Error fetching users:", error));
      });
    </script>
    <!-- show no of admin -->
    <script>
      // Function to fetch and display the total number of admins
      async function fetchAdminCount() {
        try {
          // Fetching data from backend API (replace '/api/admin/count' with your actual API endpoint)
          const response = await fetch("/admin/admin-count");

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();
          const adminCount = data.count; // Assuming the backend sends { count: 10 }

          // Displaying the total number of admins
          document.getElementById(
            "adminCount"
          ).innerText = `${adminCount}`;
        } catch (error) {
          console.error("Error fetching admin count:", error);
          document.getElementById("adminCount").innerText =
            "Error loading admin count";
        }
      }
      fetchAdminCount();
    </script>
    <!-- show no of student -->
    <script>
      // Function to fetch and display the total number of admins
      async function fetchStudentCount() {
        try {
          // Fetching data from backend API (replace '/api/student/count' with your actual API endpoint)
          const response = await fetch("/admin/student-count");

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();
          const studentCount = data.count; // Assuming the backend sends { count: 10 }

          // Displaying the total number of students
          document.getElementById(
            "studentCount"
          ).innerText = `${studentCount}`;
        } catch (error) {
          console.error("Error fetching student count:", error);
          document.getElementById("studentCount").innerText =
            "Error loading student count";
        }
      }
      fetchStudentCount();
    </script>
    <!-- show no of teacher -->
    <script>
      // Function to fetch and display the total number of admins
      async function fetchTeacherCount() {
        try {
          // Fetching data from backend API (replace '/api/student/count' with your actual API endpoint)
          const response = await fetch("/admin/teacher-count");

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();
          const teacherCount = data.count; // Assuming the backend sends { count: 10 }

          // Displaying the total number of students
          document.getElementById(
            "teacherCount"
          ).innerText = `${teacherCount}`;
        } catch (error) {
          console.error("Error fetching teacher count:", error);
          document.getElementById("teacherCount").innerText =
            "Error loading teacher count";
        }
      }
      fetchTeacherCount();
    </script>
    <!-- show no of organisation -->
    <script>
      // Function to fetch and display the total number of admins
      async function fetchOrganisationCount() {
        try {
          // Fetching data from backend API (replace '/api/student/count' with your actual API endpoint)
          const response = await fetch("/admin/organisation-count");

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();
          const organisationCount = data.count; // Assuming the backend sends { count: 10 }

          // Displaying the total number of students
          document.getElementById(
            "organisationCount"
          ).innerText = `${organisationCount}`;
        } catch (error) {
          console.error("Error fetching organisation count:", error);
          document.getElementById("organisationCount").innerText =
            "Error loading organisation count";
        }
      }
      fetchOrganisationCount();
    </script>
    <script>
      const refreshBtn = document.getElementById("dashboardbtn");
      refreshBtn.addEventListener("click", function () {
        window.location.reload();
      });
    </script>
  </body>
</html>
